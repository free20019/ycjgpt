(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0c439946"],{c860:function(a,e,t){"use strict";var i=t("d226"),n=t.n(i);n.a},d226:function(a,e,t){},f6fe:function(a,e,t){"use strict";t.r(e);var i=function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",{staticClass:"tw-template-wrapper"},[t("div",{staticClass:"tw-map-box",attrs:{id:"arcgisMap"}}),t("dl",{staticClass:"tw-map-tool-bar tw-map-tool-right"},[t("dd",{staticClass:"tw-map-tool-item",class:[{active:a.mapQueryPanel},a.iconClassName("icon-list")],on:{click:a.handleMapQueryPanelDisplayClick}}),a._l(a.platformList,(function(e){return t("el-tooltip",{key:e.ABB_NAME,attrs:{effect:"dark",content:e.ABB_NAME,placement:"left"}},[t("dd",{staticClass:"tw-map-tool-item",class:{active:a.haslatformActive(e.ABB_NAME)},on:{click:function(t){return a.handlePlatformClick(e)}}},[t("i",{class:a.iconClassName(e.icon||"")})])])}))],2),t("el-form",{staticClass:"tw-map-tool-bar tw-map-tool-bottom",attrs:{inline:""}},[t("el-form-item",{staticClass:"tw-map-tool-item",attrs:{label:"平台："}},[a._v(a._s(a.company.name))]),t("el-form-item",{staticClass:"tw-map-tool-item",attrs:{label:"在线："}},[a._v(a._s(a.company.zx))]),t("el-form-item",{staticClass:"tw-map-tool-item",attrs:{label:"载客："}},[a._v(a._s(a.company.zk))]),t("el-form-item",{staticClass:"tw-map-tool-item",attrs:{label:"空载："}},[a._v(a._s(a.company.kz))]),t("el-form-item",{staticClass:"tw-map-tool-item",attrs:{label:"占比："}},[a._v(a._s(a.company.lv))])],1),t("transition",{attrs:{name:"mapQueryPanel"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:a.mapQueryPanel,expression:"mapQueryPanel"}],staticClass:"tw-map-query-panel"},[t("el-input",{staticClass:"tw-search-for",attrs:{size:"small",placeholder:"车牌号码"},model:{value:a.searchfor,callback:function(e){a.searchfor=e},expression:"searchfor"}},[t("span",{staticClass:"el-input__icon el-button el-button--primary el-button--small el-icon-search",attrs:{slot:"suffix"},on:{click:a.handleSearchForClick},slot:"suffix"})]),t("ul",{staticClass:"tw-list tw-list-border"},[t("el-scrollbar",{staticClass:"tw-scrollbar tw-y"},a._l(a.vehicleList,(function(e){return t("li",{key:e.id,staticClass:"tw-list-item",class:{"tw-text-error":e.type},on:{click:function(t){return a.handleVehicleClick(e)}}},[t("i",{staticClass:"tw-icon--prefix el-icon-location-outline"}),a._v(a._s(e.vehino)+a._s(e.TYPE?"（未上线）":"")+"\n\t\t\t\t\t\t"),e.TYPE?a._e():t("i",{staticClass:"tw-icon-platform",class:[a.iconClassName(e.icon||"")]}),t("el-button",{staticClass:"tw-list-suffix",attrs:{type:"text",icon:"iconfont icon-trajectory",size:"mini"},nativeOn:{click:function(t){return t.stopPropagation(),a.handleVehiclelsgj(e)}}})],1)})),0)],1)],1)])],1)},n=[],l=t("3835"),s=t("6e58"),o=t("bbd5"),c=t("bc3a"),r=t.n(c),m=t("c46f"),p=t("1157"),d=t.n(p),f=t("c1df"),u=t.n(f),h={name:"VehicleDynamicMonitor",data:function(){return{searchfor:"",vehicleList:[{id:1,type:!0,name:"浙A12340"},{id:2,type:!1,name:"浙A12341"},{id:3,type:!1,name:"浙A12342"},{id:4,type:!1,name:"浙A12343"},{id:5,type:!1,name:"浙A12344"},{id:6,type:!0,name:"浙A12345"},{id:7,type:!1,name:"浙A12346"},{id:8,type:!0,name:"浙A12347"}],mapQueryPanel:!1,platformActive:"全部",platformList:[{title:"卓卓1",icon:"icon-kefu",data:{zx:7310,zk:2849,kz:4461}},{title:"卓卓2",icon:"icon-taxi",data:{zx:2048,zk:1588,kz:460}},{title:"卓卓3",icon:"icon-key",data:{zx:2954,zk:954,kz:2e3}},{title:"卓卓4",icon:"icon-ddzc",data:{zx:2954,zk:954,kz:2e3}}],map:{loading:!1,arcgisMap:null,levelMap:null,dialog:null,level:6,ismar:0},company:{id:"all",name:"全部",zk:0,zx:0,kz:0,lv:"100%"}}},mounted:function(){var a=this;this.$nextTick((function(){var e=a;a.mapQueryPanel=!0,a.getCompanyLIst(),a.getVehicleList();try{a.map.loading=!0,Object(s["a"])(["esri/map","esri/basemaps","esri/layers/GraphicsLayer","esri/lang","dijit/TooltipDialog","dijit/popup","dojo/dom-style"]).then((function(t){var i=Object(l["a"])(t,7),n=i[0],o=i[1],c=i[2],r=i[3],m=i[4],p=i[5],f=i[6];o.mapLayerPath=s["b"],e.map.arcgisMap=new n("arcgisMap",{basemap:"mapLayerPath",spatialReference:{wkid:4326},slider:!1,center:[120.197521,30.24298],zoom:5}),e.map.arcgisMap.infoWindow.resize(245,125),e.map.dialog=new m({style:"position: absolute; width: 350px; font: normal normal normal 10pt Helvetica;z-index:100"}),e.map.dialog.startup(),a.map.arcgisMap.on("load",(function(){e.map.levelMap=new c({id:"levelmap"}),e.map.arcgisMap.addLayer(e.map.levelMap),e.map.loading=!1,e.map.levelMap.on("click",(function(t){if(d()(".mapDialog").hide(),p.close(e.map.dialog),e.map.level>8){var i=t.graphic.attributes,n='<div class="mapDialog" style=""><div class="mapToolPanel"><TitleCircle><HyperCircle></HyperCircle>网约车-'+i.vehino+'<HyperCircle></HyperCircle><i class="iconfont icon-close"></i></TitleCircle><div class="conent" style="padding-top: 20px;"><div class="rowbox clearfix"><div class="normBox" type="left" style="display: inline-block;"><div class="normTitle">速度</div><div class="normInfo sbig"><span class="intensify">'+i.speed+'</span>KM/H</div></div><div class="normBox" type="right" style="display: inline-block;"><div class="normTitle">营运状态</div><div class="normInfo sbig" style="font-size: 18px">'+e.fomarttype(i.bizStatus)+'</div></div></div><div class="normBox" type="left"><div class="normTitle">GPS时间</div><div class="normInfo sbig">'+e.fomarttime(i.dateTime)+'</div></div><div class="normBox" type="left"><div class="normTitle">所属公司</div><div class="normInfo sbig">'+i.vehName+'</div></div></div><span class="bottomRight golsgj" style="cursor: pointer;font-size: 18px;color:aliceblue;">轨迹</span></div></div>',l=r.substitute(t.graphic.attributes,n);e.map.dialog.setContent(l),f.set(e.map.dialog.domNode,"opacity",.85),p.open({popup:e.map.dialog,x:t.pageX,y:t.pageY}),d()(".icon-close").click((function(){d()(".mapDialog").hide(),p.close(e.map.dialog)})),d()(".golsgj").on("click",(function(){d()(".mapDialog").hide(),p.close(e.map.dialog),a.handleVehiclelsgj(i)}))}})),e.map.arcgisMap.on("zoom-end",(function(a){e.mapOnchange(a)})),e.map.arcgisMap.on("mouse-drag-end",(function(a){e.map.level>=9&&e.mapOnchange(a)})),e.getMapLayered()}))}))}catch(t){}}))},computed:{platformOnlinData:function(){var a=this.platformActive,e=this.platformList;if(0===a.length){var t={zx:0,zk:0,kz:0};return m["a"].each(e,(function(a){t.zx+=a.ONLINE_NUM,t.zk+=a.HEAVY_NUM,t.kz+=a.EMAPY_NUM})),t}return m["a"].filter(e,(function(e){return e.title===a}))[0].data}},methods:{iconClassName:o["c"],handleSearchForClick:function(){this.getVehicleList()},handleMapQueryPanelDisplayClick:function(){this.mapQueryPanel=!this.mapQueryPanel},handlePlatformClick:function(a){var e=this;this.platformActive=a.ABB_NAME,this.company.id=a.COMPANYID,this.company.name=a.ABB_NAME,this.company.kz=a.EMAPY_NUM,this.company.zk=a.HEAVY_NUM,this.company.zx=a.ONLINE_NUM,this.company.lv=a.LV,Object(s["a"])(["esri/geometry/webMercatorUtils"]).then((function(a){var t=Object(l["a"])(a,1);t[0];if(e.map.levelMap.clear(),e.map.level<9)e.getMapLayered();else{var i=e.map.arcgisMap.extent.getCenter();e.getMapLayered9(i.x,i.y)}}))},haslatformActive:function(a){return this.platformActive===a},fomarttime:function(a){return u()(a).format("YYYY-MM-DD HH:mm:ss")},fomarttype:function(a){return"1"==a?"载客":"2"==a?"接单":"3"==a?"空驶":"4"==a?"停运":void 0},getCompanyLIst:function(){var a=this;r.a.get("map/getCompany",{baseURL:this.baseURL}).then((function(e){a.platformList=e.data,m["a"].each(e.data,(function(e){"全部"===e.ABB_NAME&&(a.company.kz=e.EMAPY_NUM,a.company.zk=e.HEAVY_NUM,a.company.zx=e.ONLINE_NUM,a.company.lv=e.LV)}))}))},getVehicleList:function(){var a=this;r.a.get("map/getVehicle",{baseURL:this.baseURL,params:{vhic:this.searchfor}}).then((function(e){a.vehicleList=e.data}))},mapOnchange:function(a){this.map.levelMap.clear();var e=this;null!=a.level&&(this.map.level=a.level),Object(s["a"])(["esri/geometry/webMercatorUtils","dijit/popup"]).then((function(a){var t=Object(l["a"])(a,2),i=(t[0],t[1]);if(d()(".mapDialog").hide(),i.close(e.map.dialog),e.map.levelMap.clear(),e.map.level<9)e.getMapLayered();else{var n=e.map.arcgisMap.extent.getCenter();e.getMapLayered9(n.x,n.y)}}))},getMapLayered:function(){var a=this;r.a.get("map/getMapLayered",{baseURL:this.baseURL,params:{level:this.map.arcgisMap.getZoom(),comp_id:this.company.id}}).then((function(e){m["a"].each(e.data,(function(e){a.myAddmark(e.PX,e.PY,e.AREANUM)}))}))},getMapLayered9:function(a,e){var t=this;r.a.get("map/getGet",{baseURL:this.baseURL,params:{level:this.map.arcgisMap.getZoom(),px:a,py:e,comp_id:this.company.id,type:"0"}}).then((function(a){m["a"].each(a.data,(function(a){t.addmar(a)}))}))},addmar:function(a){var e=this;Object(s["a"])(["esri/geometry/Point","esri/graphic","esri/symbols/PictureMarkerSymbol"]).then((function(t){var i=Object(l["a"])(t,3),n=i[0],s=i[1],o=i[2],c=new n({x:a.longi-.0049,y:a.lati+.0025,spatialReference:{wkid:4326}}),r="";"didi"===a.mdt_no?r="image/marker/dd.png":"shenzhou"===a.mdt_no?r="image/marker/sz.png":"caocao"===a.mdt_no?r="image/marker/cc.png":"yidao"===a.mdt_no?r="image/marker/yd.png":"aa"===a.mdt_no?r="image/marker/aa.png":"yangguangchedao"===a.mdt_no?r="image/marker/yg.png":"wanshun"===a.mdt_no?r="image/marker/ws.png":"shouyue"===a.mdt_no&&(r="image/marker/sy.png");var m=o(e.baseURL+r,36,36).setOffset(18,18);e.map.levelMap.add(new s(c,m,a,""))}))},myAddmark:function(a,e,t){var i=this;Object(s["a"])(["esri/geometry/Point","esri/graphic","esri/symbols/SimpleMarkerSymbol","esri/symbols/TextSymbol","esri/symbols/Font"]).then((function(n){var s=Object(l["a"])(n,5),o=s[0],c=s[1],r=s[2],m=s[3],p=s[4],d=new o(a,e),f={},u="";parseInt(t)>=1e3?(u="50",f={a:1,r:216,g:30,b:6}):parseInt(t)>=500&&t<1e3?(u="45",f={a:1,r:244,g:138,b:42}):parseInt(t)>=100&&t<500?(u="35",f={a:1,r:18,g:150,b:219}):(u="30",f={a:1,r:42,g:234,b:42});var h=new r({color:f,size:u,angle:0,xoffset:0,yoffset:0,style:"esriSMSCircle",outline:{color:"",width:0,type:"esriSLS",style:"esriSLSSolid"}});i.map.background=new c(d,h),i.map.levelMap.add(i.map.background);var g=new m({text:t,color:{a:1,r:255,g:255,b:255},angle:0,xoffset:0,yoffset:-3,font:new p("12",p.STYLE_ITALIC,p.VARIANT_NORMAL,p.WEIGHT_BOLD,"Courier")});i.map.font=new c(d,g),i.map.levelMap.add(i.map.font)}))},handleVehicleClick:function(a){this.map.ismar++;var e=this;Object(s["a"])(["dijit/popup"]).then((function(a){var t=Object(l["a"])(a,1),i=t[0];d()(".mapDialog").hide(),i.close(e.map.dialog)})),a.TYPE?this.$message({message:"车辆未上线！",type:"warning"}):(e.map.arcgisMap.centerAndZoom([a.longi-.0049,a.lati+.0025],10),e.map.ismar>1?(e.map.levelMap.clear(),e.addmar(a)):setTimeout((function(){e.map.levelMap.clear(),e.addmar(a)}),1200))},handleVehiclelsgj:function(a){this.$router.push({name:"HistoricalTrackPlayback",params:{vhic:a.vehino}})}}},g=h,v=(t("c860"),t("2877")),y=Object(v["a"])(g,i,n,!1,null,"02c358a6",null);e["default"]=y.exports}}]);
//# sourceMappingURL=chunk-0c439946.afec2b25.js.map